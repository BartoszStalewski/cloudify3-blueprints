
plugins:
    xap_config_plugin:
        executor: host_agent
        source: xap-config-plugin

    xap_admin_plugin:
        executor: host_agent
        source: xap-admin-plugin

    xap_plugin:
        executor: central_deployment_agent
        source: xap-plugin


workflows:
    my_workflow:
        mapping: xap_plugin.xap_workflows.gateway_workflow.start_gateway
        parameters:
          space_name:
            description: The space's name
            default: "myDataGrid"
          space_zones:
            default: 'spacezone'
          gateway_name:
            default: "SITE-A"
          gateway_pu_zones:
            default: 'gatewayzone'
          gateway_sources:
            default: ["SITE-B"]
          gateway_targets:
            default: ["SITE-B"]
          gateway_lookups:
            default: [{'gwname':'SITE-B','address':'11.0.0.8','discoport':10000,'commport':10001}]
          gateway_natmappings:
            default: ''
          gateway_discoport:
            default: 10000
          gateway_commport:
            default: 10001
          rest_port:
            default: 8888
          rest_zones:
            default: "restzone"
    deploy_grid:
        mapping: workflows/deploy_grid.py
        parameters:
            grid_name:
              default: dataGrid
            schema:
              default: partitioned-sync2backup
            partitions:
              default: 1
            backups:
              default: 0
            max_per_vm:
              default: 0
            max_per_machine:
              default: 0
    undeploy_grid:
        mapping: workflows/undeploy_grid.py
        parameters:
            grid_name:
              default: dataGrid
    deploy_pu:
        mapping: workflows/deploy_pu.py
        parameters:
            pu_url:
              default: ""
            override_pu_name:
              default: ""
            schema:
              default: partitioned-sync2backup
            partitions:
              default: 1
            backups:
              default: 0
            max_per_vm:
              default: 0
            max_per_machine:
              default: 0
    auto_heal_workflow:
        mapping: default_workflows.cloudify.plugins.workflows.auto_heal_reinstall_node_subgraph
        parameters:
            node_id:
              description: none


relationships:
    xap_connected_to_lus:
        derived_from: cloudify.relationships.connected_to
        source_interfaces:
            cloudify.interfaces.relationship_lifecycle:
                postconfigure:
                    implementation: xap-scripts/get_locators.py
                    inputs: {}

outputs:
    management_ui:
      description: XAP UI URL
      value:
        ip: {  get_attribute: [ xap_management_vm,  ip ] }
        port: { get_property: [ webui , webui_port ] }

    xap_interactive_tutorial:
      description: XAP Interactive Tutorial's URL
      value:
        ip: { get_attribute: [ xap_management_vm , ip ] }
        port: { get_property: [ demo_shell , port ] }
